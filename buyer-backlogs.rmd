---
output: html_document
---

```{r include=FALSE}
source("./buyer-backlogs.r")
```
```{r echo=FALSE}
kable(backlog_kable) %>% 
  kable_styling() %>% 
  add_header_above(c(" " = 1, "Actionable" = 4, "On Hold" = 1, "Out-to-Bid" = 1, " " = 1)) %>% 
  group_rows(index = c("Non-Inventory" = 7, "Sourcing Exec." = 7, "Inventory" = 7, "Total" = 1)) %>% 
  row_spec(c(7,14,21), italic = TRUE, background = "#EEEEEE") %>% 
  row_spec(22, bold = TRUE)
```
<P style="page-break-before: always">
```{r echo=FALSE, fig.width=10}
ggplotly(ggplot(backlog_plot) + 
           geom_bar(mapping = aes(x = Buyer, y = Count, fill = Type), 
                    stat = "identity", 
                    position = position_stack(reverse = TRUE)) +
           scale_fill_brewer(palette = "Spectral", direction = -1) +
           coord_flip()) %>%  
  layout(yaxis = list(autorange = "reversed"))

backlog_plot %>% split(backlog_plot$Category) %>%
  map(plot_ly, 
      y = ~Buyer, 
      x = ~Count, 
      color = ~Type, 
      type = "bar", 
      colors = c(
        "#99D594","#FFFFBF", "#FC8D59"),
      legendgroup = ~Type) %>% 
  map(layout, yaxis = list(autorange = "reversed"), barmode = 'stack') %>% 
  subplot(nrows = 3, margin = .05, shareX = TRUE)
```

Using data obtained on `r data_date`.

Filtering with approval date from `r date_from` to `r date_to`.